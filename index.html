<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>URL Redirect Tool - abc.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style> body { font-family: system-ui, -apple-system, sans-serif; } </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
  <div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-2xl shadow-xl p-8">
      <div class="flex items-center gap-3 mb-8">
        <div class="bg-indigo-600 p-3 rounded-lg">
          <svg class="text-white" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">URL Redirect Tool</h1>
          <p class="text-gray-600">Create short abc.com links with blank tab redirect</p>
        </div>
      </div>

      <div class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Enter URL or PDF Link</label>
          <input type="text" id="longUrl" placeholder="https://example.com/..." class="w-full px-4 py-3 border border-gray-300 rounded-lg" />
          <p id="error" class="mt-2 text-sm text-red-600 hidden"></p>
        </div>

        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex items-start gap-2">
            <input type="checkbox" id="isPdf" class="mt-1" onchange="togglePdfOptions()" />
            <div class="flex-1">
              <label for="isPdf" class="font-medium text-blue-900 cursor-pointer">This is a PDF file (force download)</label>
              <p class="text-sm text-blue-700 mt-1">Check this to automatically download PDFs instead of opening in browser.</p>
            </div>
          </div>
        </div>

        <button onclick="generateUrl()" class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">Generate Short URL</button>

        <div id="result" class="hidden bg-green-50 border border-green-200 rounded-lg p-6 space-y-4">
          <div>
            <label class="block text-sm font-medium text-green-900 mb-2">Your Short URL</label>
            <div class="flex gap-2">
              <input type="text" id="shortUrl" readonly class="flex-1 px-4 py-3 bg-white border border-green-300 rounded-lg font-mono text-sm" />
              <button onclick="copyUrl()" class="px-4 py-3 bg-green-600 text-white rounded-lg" title="Copy to clipboard"><span id="copyIcon">üìã</span></button>
            </div>
          </div>

          <button onclick="testRedirect()" class="w-full bg-white border border-green-600 text-green-700 py-2 rounded-lg">
            <span id="testIcon">üîó</span> <span id="testText">Test Redirect (Opens Helper Tab)</span>
          </button>

          <div class="text-sm text-green-800 bg-green-100 p-3 rounded"><strong>How it works:</strong> <span id="howItWorks"></span></div>
        </div>

        <div id="history" class="hidden border-t pt-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Redirects</h3>
          <div id="redirectList" class="space-y-2 max-h-60 overflow-y-auto"></div>
        </div>
      </div>
    </div>

    <div class="mt-6 text-center text-sm text-gray-600">
      <p>‚ú® Supports both regular URLs and PDF downloads ‚Ä¢ Blank page shields URLs from Google crawlers</p>
    </div>
  </div>

  <script>
    // Load & handle short codes on page load
    const path = window.location.pathname;
    const hashCode = window.location.hash.substring(1);
    if (path !== '/' && path !== '/index.html' && path !== '') handleRedirect(path.substring(1));
    else if (hashCode) handleRedirect(hashCode);

    function getRedirects() {
      try { return JSON.parse(localStorage.getItem('redirects') || '{}'); }
      catch { return {}; }
    }
    function saveRedirects(r) { localStorage.setItem('redirects', JSON.stringify(r)); }
    function generateShortCode() { return Math.random().toString(36).substring(2,8); }
    function isValidUrl(s) { try { new URL(s); return true; } catch (_) { return false; } }
    function togglePdfOptions(){}

    // handleRedirect: open a helper window that performs the action then closes itself.
    function handleRedirect(code) {
      const redirects = getRedirects();
      if (!redirects[code]) return;
      const data = redirects[code];

      // Clear current page for crawler-friendliness
      document.body.style.background = '#f3f4f6';
      document.body.innerHTML = '';

      const quotedUrl = JSON.stringify(data.url);

      if (data.isPdf) {
        // Try to open a helper window (must be user-initiated to avoid popup blocking)
        const helper = window.open('', '_blank');
        if (helper) {
          const helperHtml = `
            <!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Starting download...</title></head>
            <body style="display:flex;align-items:center;justify-content:center;height:100vh;margin:0;font-family:system-ui;">
              <div style="text-align:center;color:#065f46;">
                <div style="font-size:42px;margin-bottom:8px;">üì•</div>
                <div style="font-weight:600;margin-bottom:6px;">Starting download‚Ä¶</div>
                <div style="font-size:13px;color:#6b7280;">If the download doesn't start, close this tab and try the original link.</div>
              </div>
              <script>
                (function(){
                  try {
                    var url = ${quotedUrl};
                    var a = document.createElement('a');
                    a.href = url;
                    try {
                      a.download = (new URL(url)).pathname.split('/').pop() || 'download.pdf';
                    } catch (e) { a.download = 'download.pdf'; }
                    a.style.display = 'none';
                    document.body.appendChild(a);
                    a.click();
                    // close helper after a short delay so download can begin
                    setTimeout(function(){ try { window.close(); } catch(e){} }, 2000);
                  } catch(e) {
                    document.body.innerHTML = '<div style="padding:20px;font-family:system-ui;color:#92400e;">Failed to start automatic download. <a href="' + ${quotedUrl} + '" target="_blank" rel="noopener">Click here to download</a></div>';
                  }
                })();
              </script>
            </body></html>
          `;
          helper.document.write(helperHtml);
          helper.document.close();

          // fallback closer from opener if helper doesn't self-close
          setTimeout(()=>{ try { if (!helper.closed) helper.close(); } catch(e){} }, 6000);

          document.body.innerHTML = '<div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-size:18px;color:#059669;text-align:center;padding:20px;font-family:system-ui;"><div style="font-size:42px;margin-bottom:15px;">‚úì</div><div style="font-weight:600;margin-bottom:8px;">Download Initiated</div><div style="font-size:14px;color:#6b7280;">This tab will close automatically if allowed by your browser.</div></div>';
          setTimeout(()=>{ try { window.close(); } catch(e){} }, 3000);
        } else {
          // Popup blocked: download in same tab
          const link = document.createElement('a');
          link.href = data.url;
          link.download = data.url.split('/').pop() || 'download.pdf';
          link.style.display = 'none';
          document.body.appendChild(link);
          link.click();
          document.body.removeChild(link);
          document.body.innerHTML = '<div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-size:18px;color:#059669;text-align:center;padding:20px;font-family:system-ui;"><div style="font-size:42px;margin-bottom:15px;">‚úì</div><div style="font-weight:600;margin-bottom:8px;">Download Started</div><div style="font-size:14px;color:#6b7280;">Popup blocked ‚Äî this tab cannot be closed automatically.</div></div>';
        }
      } else {
        // Non-PDF: open destination in a new tab from helper, then close helper
        const helper = window.open('', '_blank');
        if (helper) {
          const helperHtml = `
            <!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Redirecting‚Ä¶</title></head>
            <body style="display:flex;align-items:center;justify-content:center;height:100vh;margin:0;font-family:system-ui;">
              <div style="text-align:center;color:#0f172a;">
                <div style="font-size:42px;margin-bottom:8px;">üîó</div>
                <div style="font-weight:600;margin-bottom:6px;">Redirecting‚Ä¶</div>
                <div style="font-size:13px;color:#6b7280;">If you are not taken, <a id='fallback' href='#'>click here</a>.</div>
              </div>
              <script>
                (function(){
                  try {
                    var url = ${quotedUrl};
                    // Open destination in a new tab (script-opened helper -> permitted)
                    var dest = window.open(url, '_blank');
                    if (dest) {
                      // Close helper after short delay
                      setTimeout(function(){ try { window.close(); } catch(e){} }, 1000);
                    } else {
                      // Fallback: navigate helper in same tab if opening new tab is blocked
                      location.replace(url);
                    }
                    // expose fallback link if needed
                    var f = document.getElementById('fallback');
                    if (f) f.href = url;
                  } catch(e) {
                    var f = document.getElementById('fallback');
                    if (f) f.href = url;
                  }
                })();
              </script>
            </body></html>
          `;
          helper.document.write(helperHtml);
          helper.document.close();

          // ensure helper closed if it couldn't close itself
          setTimeout(()=>{ try { if (!helper.closed) helper.close(); } catch(e){} }, 7000);

          document.body.innerHTML = '<div style="display:flex;flex-direction:column;justify-content:center;align-items:center;height:100vh;font-size:18px;color:#0f5132;text-align:center;padding:20px;font-family:system-ui;"><div style="font-size:42px;margin-bottom:15px;">‚Ü™Ô∏è</div><div style="font-weight:600;margin-bottom:8px;">Opening destination in a new tab‚Ä¶</div><div style="font-size:14px;color:#6b7280;">This tab will close automatically if allowed by your browser.</div></div>';
          setTimeout(()=>{ try { window.close(); } catch(e){} }, 3000);
        } else {
          // Popup blocked: fallback to same-tab redirect
          window.location.replace(data.url);
        }
      }
    }

    function generateUrl() {
      const longUrlInput = document.getElementById('longUrl');
      const errorEl = document.getElementById('error');
      const isPdfCheckbox = document.getElementById('isPdf');
      const longUrl = longUrlInput.value.trim();
      const isPdf = isPdfCheckbox.checked;
      errorEl.classList.add('hidden');
      if (!longUrl) { errorEl.textContent='Please enter a URL'; errorEl.classList.remove('hidden'); return; }
      if (!isValidUrl(longUrl)) { errorEl.textContent='Please enter a valid URL (including http:// or https://)'; errorEl.classList.remove('hidden'); return; }

      const shortCode = generateShortCode();
      const currentDomain = window.location.origin;
      const shortUrl = `${currentDomain}/#${shortCode}`;
      const redirects = getRedirects();
      redirects[shortCode] = { url: longUrl, isPdf: isPdf, created: new Date().toISOString() };
      saveRedirects(redirects);
      document.getElementById('shortUrl').value = shortUrl;

      if (isPdf) {
        document.getElementById('testIcon').textContent='üì•';
        document.getElementById('testText').textContent='Test Download (Opens Helper Tab)';
        document.getElementById('howItWorks').textContent = `When someone clicks this link, a helper tab will open and trigger the PDF download and close itself. If popups are blocked the download happens in the same tab (no auto-close).`;
      } else {
        document.getElementById('testIcon').textContent='üîó';
        document.getElementById('testText').textContent='Test Redirect (Opens Helper Tab)';
        document.getElementById('howItWorks').textContent = `When clicked, a helper tab opens the destination in a new tab then closes itself. If popups are blocked the redirect happens in the same tab (no auto-close).`;
      }
      document.getElementById('result').classList.remove('hidden');
      updateHistory();
    }

    function copyUrl() {
      const shortUrlInput = document.getElementById('shortUrl');
      shortUrlInput.select();
      document.execCommand('copy');
      const copyIcon = document.getElementById('copyIcon');
      copyIcon.textContent='‚úì'; setTimeout(()=>copyIcon.textContent='üìã',2000);
    }

    function testRedirect() {
      const shortUrl = document.getElementById('shortUrl').value;
      if (!shortUrl) return;
      // Open short URL via a user-initiated click (this increases chance popups are allowed)
      const win = window.open(shortUrl, '_blank');
      if (!win) alert('Popup blocked. Please click the short URL manually: ' + shortUrl);
      else {
        // optional fallback: try to close if helper didn't
        setTimeout(()=>{ try { if (!win.closed) win.close(); } catch(e){} }, 8000);
      }
    }

    function updateHistory() {
      const redirects = getRedirects();
      const entries = Object.entries(redirects);
      if (entries.length === 0) return;
      const historyEl = document.getElementById('history');
      const listEl = document.getElementById('redirectList');
      historyEl.classList.remove('hidden');
      listEl.innerHTML = '';
      const currentDomain = window.location.origin;
      entries.reverse().slice(0,10).forEach(([code,data])=>{
        const div = document.createElement('div');
        div.className = 'bg-gray-50 p-3 rounded-lg flex items-start gap-2';
        div.innerHTML = `
          <span class="text-lg">${data.isPdf ? 'üìÑ' : 'üîó'}</span>
          <div class="flex-1 min-w-0">
            <p class="font-mono text-sm text-indigo-600 truncate">${currentDomain}/#${code}</p>
            <p class="text-xs text-gray-600 truncate">${data.url}</p>
            ${data.isPdf ? '<p class="text-xs text-green-600 font-medium mt-1">PDF Download</p>' : ''}
          </div>`;
        listEl.appendChild(div);
      });
    }

    window.addEventListener('load', updateHistory);
  </script>
</body>
</html>
