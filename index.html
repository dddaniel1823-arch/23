<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>URL Redirect Tool - abc.com</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body { font-family: system-ui, -apple-system, sans-serif; }
    .hidden { display: none; }
  </style>
</head>
<body class="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 p-8">
  <div class="max-w-2xl mx-auto">
    <div class="bg-white rounded-2xl shadow-xl p-8">
      <div class="flex items-center gap-3 mb-8">
        <div class="bg-indigo-600 p-3 rounded-lg">
          <svg class="text-white" width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path>
            <path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
          </svg>
        </div>
        <div>
          <h1 class="text-3xl font-bold text-gray-900">URL Redirect Tool</h1>
          <p class="text-gray-600">Share the short link only ‚Äî it opens the long URL in a new tab and auto-closes.</p>
        </div>
      </div>

      <div class="space-y-6">
        <div>
          <label class="block text-sm font-medium text-gray-700 mb-2">Enter URL or PDF Link</label>
          <input
            type="text"
            id="longUrl"
            placeholder="https://longurl.com/very/long/path or https://example.com/brochure.pdf"
            class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent outline-none transition"
          />
          <p id="error" class="mt-2 text-sm text-red-600 hidden"></p>
        </div>

        <div class="bg-blue-50 border border-blue-200 rounded-lg p-4">
          <div class="flex items-start gap-2">
            <input type="checkbox" id="isPdf" class="mt-1" />
            <div class="flex-1">
              <label for="isPdf" class="font-medium text-blue-900 cursor-pointer">
                This is a PDF file (auto download)
              </label>
              <p class="text-sm text-blue-700 mt-1">
                Short link starts the file download. Shows a quick confirmation, then the tab tries to close.
              </p>
            </div>
          </div>
        </div>

        <button
          type="button"
          onclick="generateUrl()"
          class="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold hover:bg-indigo-700 transition shadow-md hover:shadow-lg"
        >
          Generate Short URL
        </button>

        <div id="result" class="hidden bg-green-50 border border-green-200 rounded-lg p-6 space-y-4">
          <div>
            <label class="block text-sm font-medium text-green-900 mb-2">Your Short URL</label>
            <div class="flex gap-2">
              <input
                type="text"
                id="shortUrl"
                readonly
                class="flex-1 px-4 py-3 bg-white border border-green-300 rounded-lg font-mono text-sm"
              />
              <button
                type="button"
                onclick="copyUrl()"
                class="px-4 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition"
                title="Copy to clipboard"
              >
                <span id="copyIcon">üìã</span>
              </button>
            </div>
          </div>

          <div class="text-sm text-green-800 bg-green-100 p-3 rounded">
            <strong>How to use:</strong>
            Share only the short link below. When it‚Äôs opened, your long URL opens in a new tab and the short-link tab auto-closes. If a popup is blocked, it will open in the same tab instead.
          </div>
        </div>

        <div id="history" class="hidden border-t pt-6">
          <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Redirects</h3>
          <div id="redirectList" class="space-y-2 max-h-60 overflow-y-auto"></div>
        </div>
      </div>
    </div>

    <div class="mt-6 text-center text-sm text-gray-600">
      <p>‚ú® Shareable short links. No extra buttons or actions on the landing page.</p>
    </div>
  </div>

  <script>
    // ===== On-load: if visiting a short link like https://abc.com/#CODE, handle it immediately =====
    const path = window.location.pathname;
    const hashCode = window.location.hash.substring(1);
    const params = new URLSearchParams(window.location.search);
    const autoCloseFlag = params.has('ac') || params.get('autoclose') === '1'; // kept for compatibility

    if (path !== '/' && path !== '/index.html' && path !== '') {
      handleRedirect(path.substring(1));
    } else if (hashCode) {
      handleRedirect(hashCode);
    }

    // ===== Redirect handler ‚Äî NO BUTTONS REQUIRED =====
    function handleRedirect(code) {
      const redirects = getRedirects();
      const data = redirects[code];
      if (!data) return;

      // Minimal landing UI
      document.body.style.background = '#f3f4f6';
      document.body.innerHTML = `
        <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;
                    height:100vh;font-size:18px;color:#059669;text-align:center;padding:20px;font-family:system-ui;">
          <div style="font-size:42px;margin-bottom:15px;">‚è≥</div>
          <div style="font-weight:600;margin-bottom:6px;">Opening‚Ä¶</div>
          <div style="font-size:14px;color:#6b7280;">This tab will close automatically.</div>
        </div>`;

      if (data.isPdf) {
        // PDFs: start download in this tab (keeps address bar on our domain)
        startDownload(data.url);
      }

      // Try to open LONG URL in a NEW TAB immediately.
      // If blocked, fallback navigates this tab to the long URL.
      let newTab = null;
      try {
        newTab = window.open(data.url, '_blank', 'noopener,noreferrer');
      } catch (e) {
        newTab = null;
      }

      if (newTab) {
        // We got a new tab ‚Äî now close this short-link tab
        attemptCloseTab();
      } else {
        // Popup blocked ‚Üí fallback: same-tab navigation so user still reaches the destination
        window.location.replace(data.url);
      }
    }

    // ===== Robust download trigger for PDFs =====
    function startDownload(url) {
      try {
        const a = document.createElement('a');
        a.href = url;
        a.download = url.split('/').pop() || 'download.pdf';
        a.rel = 'noopener';
        a.style.display = 'none';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
      } catch (e) {}
      // Fallback via hidden iframe
      setTimeout(() => {
        try {
          const iframe = document.createElement('iframe');
          iframe.style.width = '0';
          iframe.style.height = '0';
          iframe.style.border = '0';
          iframe.src = url;
          document.body.appendChild(iframe);
          setTimeout(() => { try { document.body.removeChild(iframe); } catch (_) {} }, 5000);
        } catch (e) {}
      }, 120);
    }

    function attemptCloseTab() {
      const tryClose = () => {
        window.open('', '_self');
        window.close();
      };
      setTimeout(tryClose, 50);
      setTimeout(tryClose, 400);
      setTimeout(tryClose, 900);
      setTimeout(() => {
        document.title = '‚úì Completed ‚Äî you can close this tab';
        if (document.body) {
          document.body.innerHTML = `
            <div style="display:flex;flex-direction:column;justify-content:center;align-items:center;
                        height:100vh;font-size:18px;color:#059669;text-align:center;padding:20px;font-family:system-ui;">
              <div style="font-size:42px;margin-bottom:15px;">‚úì</div>
              <div style="font-weight:600;margin-bottom:6px;">All set</div>
              <div style="font-size:14px;color:#6b7280;">You can close this tab.</div>
            </div>`;
        }
      }, 1800);
    }

    // ===== Storage (local) =====
    function getRedirects() {
      const data = localStorage.getItem('redirects');
      return data ? JSON.parse(data) : {};
    }
    function saveRedirects(redirects) {
      localStorage.setItem('redirects', JSON.stringify(redirects));
    }

    // ===== Generator UI =====
    function generateShortCode() {
      return Math.random().toString(36).substring(2, 8);
    }
    function isValidUrl(string) {
      try { new URL(string); return true; } catch { return false; }
    }

    function generateUrl() {
      const longUrlInput = document.getElementById('longUrl');
      const errorEl = document.getElementById('error');
      const isPdfCheckbox = document.getElementById('isPdf');

      const longUrl = longUrlInput.value.trim();
      const isPdf = isPdfCheckbox.checked;

      errorEl.classList.add('hidden');

      if (!longUrl) {
        errorEl.textContent = 'Please enter a URL';
        errorEl.classList.remove('hidden');
        return;
      }
      if (!isValidUrl(longUrl)) {
        errorEl.textContent = 'Please enter a valid URL (including http:// or https://)';
        errorEl.classList.remove('hidden');
        return;
      }

      const shortCode = generateShortCode();
      const currentDomain = window.location.origin;
      const shortUrl = `${currentDomain}/#${shortCode}`;

      const redirects = getRedirects();
      redirects[shortCode] = {
        url: longUrl,
        isPdf: isPdf,
        created: new Date().toISOString()
      };
      saveRedirects(redirects);

      document.getElementById('shortUrl').value = shortUrl;

      document.getElementById('result').classList.remove('hidden');
      updateHistory();
    }

    function copyUrl() {
      const shortUrlInput = document.getElementById('shortUrl');
      shortUrlInput.select();
      document.execCommand('copy');
      const copyIcon = document.getElementById('copyIcon');
      copyIcon.textContent = '‚úì';
      setTimeout(() => { copyIcon.textContent = 'üìã'; }, 1500);
    }

    function updateHistory() {
      const redirects = getRedirects();
      const entries = Object.entries(redirects);
      if (entries.length === 0) return;

      const historyEl = document.getElementById('history');
      const listEl = document.getElementById('redirectList');

      historyEl.classList.remove('hidden');
      listEl.innerHTML = '';

      const currentDomain = window.location.origin;
      entries.reverse().slice(0, 10).forEach(([code, data]) => {
        const div = document.createElement('div');
        div.className = 'bg-gray-50 p-3 rounded-lg flex items-start gap-2';
        div.innerHTML = `
          <span class="text-lg">${data.isPdf ? 'üìÑ' : 'üîó'}</span>
          <div class="flex-1 min-w-0">
            <p class="font-mono text-sm text-indigo-600 truncate">${currentDomain}/#${code}</p>
            <p class="text-xs text-gray-600 truncate">${data.url}</p>
            ${data.isPdf
              ? '<p class="text-xs text-green-600 font-medium mt-1">PDF: download + auto-close</p>'
              : '<p class="text-xs text-gray-600 mt-1">Opens long URL in a new tab (fallback: same tab)</p>'
            }
          </div>
        `;
        listEl.appendChild(div);
      });
    }

    window.addEventListener('load', updateHistory);
  </script>
</body>
</html>
